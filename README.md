# Parallelize statistical simulations with Apache Beam
## ParallelMCBattery class to parallelize Monte Carlo simulations
### Installation
```bash
pip install "git+https://github.com/vladimirrotariu/parallel-monte-carlo-simulations#egg=parallel_mc_battery&subdirectory=src"
```
### Description
 `ParallelMCBattery` is a helper class to orchestrate in parallel Monte Carlo simulations. It abstracts away the creation of an efficient Apache Beam pipeline with minimal low-level parallel tuning through the `pipeline_options` attribute.

More precisely, it equips its instances with the attributes corresponding to the values for the dictionary keys:
* `rng` --> a *string* from the choices `"PCG64"`, `"Philox"`, `"SFC64"`, `"MT19937"`
* `pipeline_options` --> an instance of the class [PipelineOptions](https://beam.apache.org/releases/pydoc/2.33.0/apache_beam.options.pipeline_options.html#apache_beam.options.pipeline_options.PipelineOptions) of Apache Beam

The Monte Carlo simulations are defined by specifying the values for the dictionary keys:
* `models` --> a list of functions that embodies the logic of the model (see Jupyter notebooks below)
* `parameters` --> an __OPTIONAL__ list (possibly of lists) of values of type *float* representing the parameters of each of the model defined in `models`
* `starting point` --> an __OPTIONAL__  *float* representing the start of the Monte Carlo simulation
* `number_simulations` --> an *integer* representing the number of Monte Carlo simulations
* `number_points` --> an *integer* representing the number of points in a Monte Carlo simulation
* `output_paths` --> an __OPTIONAL__ list of *string* values representing the local paths of the output files (the BigQuery/Google Cloud Storage adaptor currently UNDER DEVELOPMENT)



 
### The demo Jupyter notebooks (highly recommended):
1. [Biased and unbiased coin sequences of arbitrary length](demo/demo.ipynb)
### General workflow
Configure the Monte Carlo parallel battery by choosing the desired random number generator, in this case [Philox](https://numpy.org/doc/stable/reference/random/bit_generators/philox.html#philox-counter-based-rng), and the pipeline options instance of the class [PipelineOptions](https://beam.apache.org/releases/pydoc/2.33.0/apache_beam.options.pipeline_options.html#apache_beam.options.pipeline_options.PipelineOptions) of Apache Beam, for this example choosing for simplicity the default settings, which means the pipeline runs on the local `Direct Runner`.
```python
options = PipelineOptions()

battery_configs = {"rng" : "Philox", "pipeline_options": options}
battery_parallel_MC = ParallelMCBattery(battery_configs=battery_configs)
```

Note that the **pipeline options** is the only way the parallel execution can be customized, as the pipeline creation, execution, and management is abstracted away by the `ParallelMCBattery` class.

Then, you may define the models, for example two distinct **parallelizable** sequences of heads 'H' and tails 'T' generated by 'tossing' coins of a given `bias`, which is a list of `parameters`, corresponding to a unique parameter in this example.
```python
def CoinSequence(number_flips, rng, bias):
    return ["H" if rng.random() <= bias[0] else "T" for _ in range(number_flips)]

models = [CoinSequence, CoinSequence]
```

unbiased_coin_config = {"parameters": [0.5], "number_simulations" : 100000, "number_points": 3}
biased_coin_config = {"parameters": [0.7], "number_simulations" : 60000, "number_points": 5}

simulation_configs = [unbiased_coin_config, biased_coin_config]

battery_parallel_MC.simulate(models, simulation_configs)


